<!DOCTYPE html>
<html>
<head>
  <title>Global Health & Weather Portal</title>
  <link rel="stylesheet" href="/static/style.css">
  <script>
    // Ask for geolocation on load
    window.onload = function () {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(success, error);
      } else {
        alert("Geolocation is not supported by this browser.");
      }
    };

    function success(position) {
      const lat = position.coords.latitude;
      const lon = position.coords.longitude;
      document.getElementById('coords').innerText = `Lat: ${lat}, Lon: ${lon}`;
      fetchWeather(lat, lon);
    }

    function error() {
      alert("Unable to retrieve your location.");
    }

    async function fetchWeather(lat, lon) {
      document.getElementById('weather').innerText = "Loading...";
      const res = await fetch(`/weather?lat=${lat}&lon=${lon}`);
      const data = await res.json();
      // display
      document.getElementById('weather').innerHTML = `
        <h2>Conditions for ${data.location}</h2>
        <p><b>Temperature:</b> ${data.temp_min}°C - ${data.temp_max}°C</p>
        <p><b>Wind Speed:</b> ${data.wind_speed} m/s</p>
        <p><b>Precipitation:</b> ${data.precipitation} mm</p>
        <p><b>Forecast:</b> ${data.forecast}</p>
        <p><b>Recommended Crop Season:</b> ${data.crop_season}</p>
        <p><b>Dengue Cases:</b> ${data.dengue}</p>
        <p><b>Malaria Cases:</b> ${data.malaria}</p>
        <p><b>Chikungunya Cases:</b> ${data.chikungunya}</p>
        <p><b>Heatwave Cases:</b> ${data.heatwave}</p>
      `;
      document.getElementById('mapFrame').src = `/map?lat=${lat}&lon=${lon}`;
    }
  </script>
</head>
<body>
  <h1>Global Health & Weather Portal</h1>
  <p id="coords">Detecting your location...</p>
  <div id="weather"></div>
  <iframe id="mapFrame" width="100%" height="500px" frameborder="0"></iframe>
</body>
</html>
